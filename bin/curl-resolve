#!/bin/sh
# curl-resolve: Test a website before setting up DNS.
#
# Source: https://github.com/ljcooke/ljcutils
# License: MIT
# Copyright: (c) 2019 Liam Cooke

set -o errexit
set -o nounset

usage() {
  cmd=$(basename "$0")
  echo "Usage: $cmd IP_ADDRESS DOMAIN [URL]"
  echo
  echo "Example: $cmd 12.34.56.78 example.com"
}

ip=${1:-}
domain=${2:-}
url=${3:-http://$domain}

if [ -z "$ip" ] || [ -z "$domain" ]; then
  usage
  exit 1
fi

curl --resolve "${domain}:80:${ip}" \
     --resolve "${domain}:443:${ip}" \
     --verbose "$url"
