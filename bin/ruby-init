#!/bin/sh
# ruby-init: Set up a Ruby project to be managed with rbenv and Bundler.
#
# Source: https://github.com/ljcooke/ljcutils
# License: MIT
# Copyright: (c) 2019 Liam Cooke

set -o errexit
set -o nounset

usage() {
  cmd=$(basename "$0")
  echo "Usage: $cmd [OPTIONS...] RUBY_VERSION"
  echo
  echo "Options:"
  echo "  -h    show this help message"
  echo
  echo "Example: $cmd 2.6.3"
}

while getopts ':h' opt; do
  case "$opt" in
    h)
      usage
      exit
      ;;
    \?)
      1>&2 echo "Unknown option: -$OPTARG"
      1>&2 echo
      1>&2 usage
      exit 1
      ;;
  esac
done

ruby_version=${1:-}

if [ -z "$ruby_version" ]; then
  1>&2 usage
  exit 1
fi

if [ -e Gemfile ]; then
  1>&2 echo "Error: File exists: Gemfile"
  exit 1
fi

rbenv install --skip-existing "$ruby_version"
rbenv local "$ruby_version"

gem install bundler

cat <<'RUBY' > Gemfile
# frozen_string_literal: true

source 'https://rubygems.org'
RUBY

bundle install
